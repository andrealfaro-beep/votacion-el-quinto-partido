<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vota tu jugada favorita</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #00C853;
    --black: #0A0A0A;
    --white: #F5F5F0;
    --gray: #1A1A1A;
    --gray-mid: #2C2C2C;
    --accent: #FFD600;
    --red: #FF3B30;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  .header {
    padding: 48px 24px 32px;
    text-align: center;
    position: relative;
  }
  .header::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: 1px; height: 40px;
    background: var(--green);
  }
  .eyebrow {
    font-size: 11px; font-weight: 600;
    letter-spacing: 4px; text-transform: uppercase;
    color: var(--green); margin-bottom: 12px;
  }
  .title {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(48px, 10vw, 88px);
    line-height: 0.9; letter-spacing: 1px;
  }
  .title span { color: var(--accent); }
  .subtitle {
    margin-top: 16px; font-size: 15px; color: #888;
    max-width: 360px; margin-left: auto; margin-right: auto; line-height: 1.5;
  }

  /* STATUS BAR */
  .status-bar {
    margin: 0 24px 32px;
    background: var(--gray);
    border: 1px solid var(--gray-mid);
    border-radius: 12px;
    padding: 16px 20px;
    display: flex; align-items: center;
    justify-content: space-between; gap: 12px;
    max-width: 836px;
  }
  @media (min-width: 900px) { .status-bar { margin-left: auto; margin-right: auto; } }
  .status-bar.voted-state { border-color: var(--green); background: rgba(0,200,83,0.08); }
  .status-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--accent); flex-shrink: 0; animation: pulse 2s infinite;
  }
  .status-dot.voted { background: var(--green); animation: none; }
  @keyframes pulse {
    0%,100% { opacity:1; transform:scale(1); }
    50% { opacity:0.4; transform:scale(1.3); }
  }
  .status-text { font-size: 13px; color: #aaa; flex: 1; }
  .status-text strong { color: var(--white); display: block; font-size: 14px; margin-bottom: 2px; }
  .total-votes { font-family: 'Bebas Neue', cursive; font-size: 28px; color: var(--accent); white-space: nowrap; }
  .total-votes span { display: block; font-family: 'DM Sans', sans-serif; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: #666; text-align: right; }

  /* GRID */
  .grid {
    display: grid; grid-template-columns: 1fr;
    gap: 16px; padding: 0 24px 40px;
    max-width: 900px; margin: 0 auto;
  }
  @media (min-width: 640px) { .grid { grid-template-columns: 1fr 1fr; } }
  @media (min-width: 900px) { .grid { padding: 0 32px 60px; } }

  /* CARD */
  .card {
    background: var(--gray);
    border: 1px solid var(--gray-mid);
    border-radius: 16px; overflow: hidden;
    transition: border-color 0.3s, transform 0.2s, opacity 0.3s;
    position: relative;
  }
  .card:hover { border-color: #444; transform: translateY(-2px); }
  .card.is-winner { border-color: var(--accent); }
  .card.is-my-vote { border-color: var(--green); }
  .card.is-voted-other { opacity: 0.45; }

  .rank {
    position: absolute; top: 12px; left: 12px; z-index: 10;
    font-family: 'Bebas Neue', cursive; font-size: 13px; letter-spacing: 1px;
    background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
    color: #888; padding: 4px 10px; border-radius: 6px; border: 1px solid #333;
  }
  .card.is-winner .rank { background: var(--accent); color: var(--black); border-color: var(--accent); }

  .voted-badge {
    display: none; position: absolute; top: 12px; right: 12px;
    background: var(--green); color: var(--black);
    font-size: 11px; font-weight: 700; letter-spacing: 1px;
    text-transform: uppercase; padding: 4px 10px; border-radius: 6px;
  }
  .card.is-my-vote .voted-badge { display: block; }

  .video-wrap {
    position: relative; width: 100%; aspect-ratio: 16/9;
    background: #111; overflow: hidden;
  }
  .video-wrap iframe { width: 100%; height: 100%; border: none; display: block; }

  .card-body { padding: 16px; }
  .player-name { font-family: 'Bebas Neue', cursive; font-size: 22px; letter-spacing: 0.5px; margin-bottom: 4px; }
  .player-desc { font-size: 12px; color: #666; margin-bottom: 14px; line-height: 1.4; }

  .vote-row { display: flex; align-items: center; gap: 12px; }
  .bar-wrap { flex: 1; height: 4px; background: var(--gray-mid); border-radius: 2px; overflow: hidden; }
  .bar-fill { height: 100%; background: var(--green); border-radius: 2px; transition: width 0.8s cubic-bezier(0.16,1,0.3,1); width: 0%; }
  .card.is-winner .bar-fill { background: var(--accent); }
  .vote-count { font-family: 'Bebas Neue', cursive; font-size: 20px; color: #555; min-width: 32px; text-align: right; }
  .card.is-winner .vote-count { color: var(--accent); }
  .card.is-my-vote .vote-count { color: var(--green); }

  .btn-vote {
    display: flex; align-items: center; gap: 8px;
    width: 100%; margin-top: 14px; padding: 12px 20px;
    border-radius: 10px; border: 1.5px solid var(--gray-mid);
    background: transparent; color: #888;
    font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.25s; justify-content: center;
  }
  .btn-vote:hover { border-color: var(--green); color: var(--green); background: rgba(0,200,83,0.06); }
  .btn-vote.voted { border-color: var(--green); background: rgba(0,200,83,0.12); color: var(--green); }
  .btn-vote svg { width: 16px; height: 16px; flex-shrink: 0; }

  /* CHANGE VOTE LINK */
  .change-vote-wrap { text-align: center; margin-top: 8px; }
  .change-vote-link {
    font-size: 11px; color: #555; background: none; border: none;
    cursor: pointer; text-decoration: underline; font-family: 'DM Sans', sans-serif;
    transition: color 0.2s;
  }
  .change-vote-link:hover { color: #888; }

  /* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .modal-overlay {
    position: fixed; inset: 0; z-index: 100;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(6px);
    display: flex; align-items: center; justify-content: center;
    padding: 24px; opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .modal {
    background: var(--gray);
    border: 1px solid #333;
    border-radius: 20px;
    padding: 32px 28px;
    width: 100%; max-width: 400px;
    transform: translateY(20px);
    transition: transform 0.3s cubic-bezier(0.16,1,0.3,1);
    position: relative;
  }
  .modal-overlay.open .modal { transform: translateY(0); }

  .modal-icon { font-size: 36px; margin-bottom: 16px; display: block; text-align: center; }

  .modal-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 32px; text-align: center;
    margin-bottom: 8px; letter-spacing: 0.5px;
  }

  .modal-video-name {
    text-align: center; font-size: 13px; color: var(--green);
    font-weight: 600; margin-bottom: 6px;
  }

  .modal-desc {
    text-align: center; font-size: 13px; color: #666;
    margin-bottom: 24px; line-height: 1.5;
  }

  .modal-label {
    font-size: 12px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; color: #888; margin-bottom: 8px; display: block;
  }

  .modal-input {
    width: 100%; background: #111; border: 1.5px solid #333;
    border-radius: 10px; padding: 14px 16px;
    color: var(--white); font-family: 'DM Sans', sans-serif;
    font-size: 15px; outline: none; transition: border-color 0.2s;
    margin-bottom: 8px;
  }
  .modal-input:focus { border-color: var(--green); }
  .modal-input.error { border-color: var(--red); }

  .modal-error {
    font-size: 12px; color: var(--red); margin-bottom: 16px;
    min-height: 18px; display: block;
  }

  /* DUPLICATE EMAIL STATE */
  .modal-duplicate {
    display: none;
    background: rgba(255,59,48,0.08);
    border: 1px solid rgba(255,59,48,0.3);
    border-radius: 10px; padding: 14px 16px;
    margin-bottom: 16px;
  }
  .modal-duplicate.show { display: block; }
  .modal-duplicate p { font-size: 13px; color: #ccc; line-height: 1.5; }
  .modal-duplicate strong { color: var(--red); }

  .btn-confirm {
    width: 100%; padding: 14px;
    background: var(--green); color: var(--black);
    border: none; border-radius: 10px;
    font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 700;
    cursor: pointer; transition: all 0.2s; margin-bottom: 12px;
  }
  .btn-confirm:hover { background: #00a844; transform: translateY(-1px); }
  .btn-confirm:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-cancel-modal {
    width: 100%; padding: 12px;
    background: transparent; color: #666;
    border: 1px solid #333; border-radius: 10px;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-cancel-modal:hover { border-color: #555; color: #888; }

  .modal-privacy {
    text-align: center; font-size: 11px; color: #444;
    margin-top: 14px; line-height: 1.5;
  }

  /* CHANGE VOTE MODAL variant */
  .modal.change-mode .modal-title { color: var(--accent); }

  /* TOAST */
  .toast {
    position: fixed; bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--green); color: var(--black);
    font-size: 14px; font-weight: 700;
    padding: 14px 24px; border-radius: 50px; z-index: 999;
    transition: transform 0.4s cubic-bezier(0.16,1,0.3,1);
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  .footer-note {
    text-align: center; padding: 0 24px 48px;
    font-size: 12px; color: #444; line-height: 1.6;
  }
</style>
</head>
<body>

<div class="header">
  <p class="eyebrow">Mundial 2026 Â· El Quinto Partido</p>
  <h1 class="title">VOTA TU<br><span>JUGADA</span></h1>
  <p class="subtitle">Un solo voto por persona. Elige la jugada que mÃ¡s te emocionÃ³.</p>
</div>

<div class="status-bar" id="statusBar">
  <div class="status-dot" id="statusDot"></div>
  <div class="status-text">
    <strong id="statusTitle">VotaciÃ³n abierta</strong>
    <span id="statusDesc">Elige tu jugada favorita entre las 10 seleccionadas</span>
  </div>
  <div class="total-votes">
    <span>TOTAL</span>
    <span id="totalVotes">0</span>
  </div>
</div>

<div class="grid" id="grid"></div>

<p class="footer-note">
  Un voto por persona Â· Tu email se usa Ãºnicamente para validar tu voto<br>
  SelecciÃ³n de jugadas realizada por el equipo editorial de El Quinto Partido
</p>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modal">
    <span class="modal-icon">âš½</span>
    <h2 class="modal-title" id="modalTitle">CONFIRMA TU VOTO</h2>
    <p class="modal-video-name" id="modalVideoName"></p>
    <p class="modal-desc" id="modalDesc">Ingresa tu email para registrar tu voto. Solo se permite un voto por persona.</p>

    <!-- ESTADO NORMAL: pedir email -->
    <div id="emailForm">
      <label class="modal-label" for="emailInput">Tu correo electrÃ³nico</label>
      <input 
        type="email" 
        id="emailInput" 
        class="modal-input" 
        placeholder="nombre@correo.com"
        autocomplete="email"
      />
      <span class="modal-error" id="emailError"></span>
    </div>

    <!-- ESTADO: email duplicado -->
    <div class="modal-duplicate" id="duplicateMsg">
      <p>Este correo <strong id="duplicateEmail"></strong> ya tiene un voto registrado para <strong id="duplicateVideo"></strong>.</p>
      <p style="margin-top:8px">Â¿Quieres cambiar tu voto a la jugada seleccionada ahora?</p>
    </div>

    <button class="btn-confirm" id="btnConfirm">Confirmar voto</button>
    <button class="btn-cancel-modal" id="btnCancel">Cancelar</button>
    <p class="modal-privacy">Tu email no serÃ¡ compartido ni usado para fines comerciales</p>
  </div>
</div>

<div class="toast" id="toast">âš½ Â¡Voto registrado!</div>

<script>
// â”€â”€â”€ VIDEOS PLACEHOLDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Reemplaza videoId con el ID real de YouTube cuando lleguen los videos
const VIDEOS = [
  { id: 1, videoId: "dQw4w9WgXcQ", name: "Carlos Mendoza", desc: "Gol de media cancha Â· Grupo A" },
  { id: 2, videoId: "ScMzIvxBSi4", name: "Luis Herrera", desc: "Volea imposible Â· Cuartos de final" },
  { id: 3, videoId: "9bZkp7q19f0", name: "Miguel Ãngel Ruiz", desc: "Chilena espectacular Â· Semifinal" },
  { id: 4, videoId: "kJQP7kiw5Fk", name: "Jorge RamÃ­rez", desc: "Tiro libre al Ã¡ngulo Â· Fase de grupos" },
  { id: 5, videoId: "RgKAFK5djSk", name: "AndrÃ©s Torres", desc: "Gambeta y golazo Â· Octavos" },
  { id: 6, videoId: "JGwWNGJdvx8", name: "Fernando LÃ³pez", desc: "DefiniciÃ³n en tiempo extra Â· Final" },
  { id: 7, videoId: "fJ9rUzIMcZQ", name: "Roberto SÃ¡nchez", desc: "Cabezazo acrobÃ¡tico Â· Grupo C" },
  { id: 8, videoId: "CevxZvSJLk8", name: "Diego Morales", desc: "Asistencia con el talÃ³n Â· Semifinal" },
  { id: 9, videoId: "7PCkvCPvDXk", name: "Eduardo Vega", desc: "Remate desde 40 metros Â· Grupo B" },
  { id: 10, videoId: "OPf0YbXqDm0", name: "Alejandro Cruz", desc: "Gol olÃ­mpico Â· Cuartos de final" },
];

// â”€â”€â”€ ESTADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// En producciÃ³n, votes deberÃ­a venir de tu API de Softr/Airtable
// Por ahora usa localStorage para simular
let votes = JSON.parse(localStorage.getItem('mundial2026_votes') || '{}');
let myVote = localStorage.getItem('mundial2026_myVote') || null;      // videoId
let myEmail = localStorage.getItem('mundial2026_myEmail') || null;    // email

// Simula votos iniciales si no existen
VIDEOS.forEach(v => { if (!votes[v.id]) votes[v.id] = Math.floor(Math.random() * 40 + 5); });
saveVotes();

// â”€â”€â”€ REGISTRO DE EMAILS (simula la base de datos) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// En producciÃ³n esto viene de Softr/Airtable via API
// AquÃ­ usamos localStorage para la demo
let emailRegistry = JSON.parse(localStorage.getItem('mundial2026_emails') || '{}');
// formato: { "email@x.com": videoId }

function saveVotes() { localStorage.setItem('mundial2026_votes', JSON.stringify(votes)); }
function saveEmail(email, videoId) {
  emailRegistry[email.toLowerCase()] = videoId;
  localStorage.setItem('mundial2026_emails', JSON.stringify(emailRegistry));
}
function checkEmail(email) { return emailRegistry[email.toLowerCase()] || null; }
function getTotalVotes() { return Object.values(votes).reduce((a, b) => a + b, 0); }
function getMaxVotes() { return Math.max(...Object.values(votes)); }

// â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let pendingVideoId = null;
let isChangingVote = false;

function openModal(videoId, changingVote = false) {
  pendingVideoId = videoId;
  isChangingVote = changingVote;

  const video = VIDEOS.find(v => v.id === videoId);
  const overlay = document.getElementById('modalOverlay');
  const modal = document.getElementById('modal');

  document.getElementById('modalVideoName').textContent = video.name;
  document.getElementById('emailInput').value = myEmail || '';
  document.getElementById('emailError').textContent = '';
  document.getElementById('emailInput').classList.remove('error');
  document.getElementById('duplicateMsg').classList.remove('show');
  document.getElementById('btnConfirm').textContent = changingVote ? 'Cambiar mi voto' : 'Confirmar voto';
  document.getElementById('modalDesc').textContent = changingVote
    ? 'Confirma tu email para cambiar tu voto a esta jugada.'
    : 'Ingresa tu email para registrar tu voto. Solo se permite un voto por persona.';

  if (changingVote) {
    modal.classList.add('change-mode');
    document.getElementById('modalTitle').textContent = 'CAMBIAR VOTO';
  } else {
    modal.classList.remove('change-mode');
    document.getElementById('modalTitle').textContent = 'CONFIRMA TU VOTO';
  }

  overlay.classList.add('open');
  setTimeout(() => document.getElementById('emailInput').focus(), 300);
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  pendingVideoId = null;
  isChangingVote = false;
}

// Confirmar voto
document.getElementById('btnConfirm').addEventListener('click', handleConfirm);
document.getElementById('emailInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') handleConfirm();
});
document.getElementById('btnCancel').addEventListener('click', closeModal);
document.getElementById('modalOverlay').addEventListener('click', e => {
  if (e.target === document.getElementById('modalOverlay')) closeModal();
});

function handleConfirm() {
  const emailInput = document.getElementById('emailInput');
  const email = emailInput.value.trim().toLowerCase();
  const errorEl = document.getElementById('emailError');
  const duplicateEl = document.getElementById('duplicateMsg');

  // Validar formato
  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    emailInput.classList.add('error');
    errorEl.textContent = 'Ingresa un correo electrÃ³nico vÃ¡lido';
    return;
  }
  emailInput.classList.remove('error');
  errorEl.textContent = '';

  // Verificar si el email ya votÃ³
  const existingVote = checkEmail(email);

  if (existingVote && existingVote != pendingVideoId && !isChangingVote) {
    // Email ya existe con voto diferente â€” mostrar estado duplicado
    const existingVideo = VIDEOS.find(v => v.id == existingVote);
    document.getElementById('duplicateEmail').textContent = email;
    document.getElementById('duplicateVideo').textContent = existingVideo ? existingVideo.name : 'otra jugada';
    duplicateEl.classList.add('show');
    document.getElementById('btnConfirm').textContent = 'SÃ­, cambiar mi voto';
    isChangingVote = true;
    return;
  }

  if (existingVote && existingVote == pendingVideoId) {
    // Ya votÃ³ por el mismo video
    errorEl.textContent = 'Ya votaste por esta jugada con este correo.';
    return;
  }

  // Registrar voto
  registerVote(email, pendingVideoId, existingVote);
}

function registerVote(email, newVideoId, previousVideoId) {
  // Si estÃ¡ cambiando voto, restar el voto anterior
  if (previousVideoId) {
    votes[previousVideoId] = Math.max(0, (votes[previousVideoId] || 0) - 1);
  }

  // Si ya tenÃ­a voto en localStorage, restar tambiÃ©n
  if (myVote && myVote != previousVideoId) {
    votes[myVote] = Math.max(0, (votes[myVote] || 0) - 1);
  }

  // Sumar nuevo voto
  votes[newVideoId] = (votes[newVideoId] || 0) + 1;

  // Guardar estado
  myVote = newVideoId;
  myEmail = email;
  localStorage.setItem('mundial2026_myVote', newVideoId);
  localStorage.setItem('mundial2026_myEmail', email);
  saveVotes();
  saveEmail(email, newVideoId);

  closeModal();
  showToast(previousVideoId ? 'ğŸ”„ Â¡Voto actualizado!' : 'âš½ Â¡Voto registrado!');
  render();
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const maxVotes = getMaxVotes();
  const sorted = [...VIDEOS].sort((a, b) => votes[b.id] - votes[a.id]);

  sorted.forEach((video, index) => {
    const voteCount = votes[video.id] || 0;
    const pct = maxVotes > 0 ? (voteCount / maxVotes * 100).toFixed(1) : 0;
    const isMyVote = myVote == video.id;
    const isWinner = index === 0;
    const hasVoted = myVote !== null;

    const card = document.createElement('div');
    card.className = [
      'card',
      isWinner ? 'is-winner' : '',
      isMyVote ? 'is-my-vote' : '',
      hasVoted && !isMyVote ? 'is-voted-other' : ''
    ].filter(Boolean).join(' ');

    card.innerHTML = `
      <div class="rank">${isWinner ? 'ğŸ† #1' : '#' + (index + 1)}</div>
      <div class="voted-badge">MI VOTO</div>
      <div class="video-wrap">
        <iframe
          src="https://www.youtube.com/embed/${video.videoId}?rel=0&modestbranding=1"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen loading="lazy">
        </iframe>
      </div>
      <div class="card-body">
        <div class="player-name">${video.name}</div>
        <div class="player-desc">${video.desc}</div>
        <div class="vote-row">
          <div class="bar-wrap">
            <div class="bar-fill" style="width:${pct}%"></div>
          </div>
          <div class="vote-count">${voteCount}</div>
        </div>
        <button class="btn-vote${isMyVote ? ' voted' : ''}" data-id="${video.id}">
          ${isMyVote
            ? `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Tu voto`
            : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14z"/></svg> Votar por esta jugada`
          }
        </button>
        ${isMyVote ? `
          <div class="change-vote-wrap">
            <button class="change-vote-link" data-id="${video.id}">Â¿Cambiaste de opiniÃ³n? Cambia tu voto</button>
          </div>` : ''}
      </div>
    `;

    grid.appendChild(card);
  });

  updateStatus();
  document.getElementById('totalVotes').textContent = getTotalVotes().toLocaleString();

  // Eventos â€” votar
  document.querySelectorAll('.btn-vote:not(.voted)').forEach(btn => {
    btn.addEventListener('click', () => openModal(parseInt(btn.dataset.id)));
  });

  // Evento â€” cambiar voto
  document.querySelectorAll('.change-vote-link').forEach(btn => {
    btn.addEventListener('click', () => {
      // Mostrar todos los cards para elegir
      promptChangeVote();
    });
  });
}

function promptChangeVote() {
  // Temporalmente quita el estado "has-voted" para mostrar botones
  // y abre el modal indicando que es un cambio
  const cards = document.querySelectorAll('.card.is-voted-other');
  cards.forEach(c => {
    const btn = c.querySelector('.btn-vote');
    if (btn) {
      btn.style.pointerEvents = 'auto';
      btn.style.opacity = '1';
      btn.textContent = 'Cambiar a esta jugada';
      btn.addEventListener('click', () => openModal(parseInt(btn.dataset.id), true), { once: true });
    }
    c.style.opacity = '1';
  });

  showToast('Elige la jugada a la que quieres cambiar tu voto', 4000, '#FFD600', '#000');
}

function updateStatus() {
  const bar = document.getElementById('statusBar');
  const dot = document.getElementById('statusDot');
  const title = document.getElementById('statusTitle');
  const desc = document.getElementById('statusDesc');

  if (myVote) {
    bar.classList.add('voted-state');
    dot.classList.add('voted');
    title.textContent = 'Â¡Ya votaste!';
    const votedVideo = VIDEOS.find(v => v.id == myVote);
    desc.textContent = `Tu voto: ${votedVideo ? votedVideo.name : ''} Â· Puedes cambiar tu voto si quieres`;
  }
}

function showToast(msg = 'âš½ Â¡Voto registrado!', duration = 3000, bg = '#00C853', color = '#000') {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.style.background = bg;
  toast.style.color = color;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), duration);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
render();
</script>
</body>
</html>
